## «Утилита для управления ПВЗ»
### Список команд

1. **Принять заказ от курьера**
   На вход принимается ID заказа, ID получателя и срок хранения. Заказ нельзя принять дважды. Если срок хранения в прошлом, приложение должно выдать ошибку. Список принятых заказов необходимо сохранять в файл. Формат файла остается на выбор автора.
2. **Вернуть заказ курьеру**
   На вход принимается ID заказа. Метод должен удалять заказ из вашего файла. Можно вернуть только те заказы, у которых вышел срок хранения и если заказы не были выданы клиенту.
3. **Выдать заказ клиенту**
   На вход принимается список ID заказов. Можно выдавать только те заказы, которые были приняты от курьера и чей срок хранения меньше текущей даты. Все ID заказов должны принадлежать только одному клиенту.
4. **Получить список заказов**
   На вход принимается ID пользователя как обязательный параметр и опциональные параметры.
   Параметры позволяют получать только последние N заказов или заказы клиента, находящиеся в нашем ПВЗ.
5. **Принять возврат от клиента**
   На вход принимается ID пользователя и ID заказа. Заказ может быть возвращен в течение двух дней с момента выдачи. Также необходимо проверить, что заказ выдавался с нашего ПВЗ.
6. **Получить список возвратов**
   Метод должен выдавать список пагинированно.

### Описание архитектуры

![alt text](docs/UML-Class-Diagram.png)
в формате [UML Class Diagram](https://www.drawio.com/blog/uml-class-diagrams)

### Пример использования утилиты

Утилита содержит перечень команд, что можно производить над заказами и возвратами.

#### Заказы
  - `orders accept  [flags]`: Принять заказ от курьера
  - `orders return  [flags]`: Вернуть заказ курьеру
  - `orders deliver [flags]`: Выдать заказ клиенту
  - `orders list    [flags]`: Получить список заказов
	
#### Возвраты
  - `returns accept [flags]`: Принять возврат от клиента
  - `returns list   [flags]`: Получить список возвратов

### Руководство по работе с проектом

#### Настройка окружения

1. Создайте файл `.env` в корне проекта и добавьте необходимые переменные окружения. Пример файла `.env` можно найти среди файлов проекта.
2. Установите бинарные зависимости через `make deps`
3. Соберите Docker-контейнеры через `make build`.
4. Накатайте миграции через `make migrate`.
5. Поднимите сервисы через `make up-app`.
6. Запустите сервер с через `make server`. Пример возможных сообщений можно просмотреть в `example.txt`.

#### Сборка контейнеров

Установка зависимостей:
```sh
  make deps
```

Для сборки Docker-контейнеров выполните команду:
```sh
make build
```

#### Запуск контейнеров

Для запуска контейнеров выполните команды:
```sh
make up-app
make up-db
make up-broker
```

Если вам нужно запустить только определенные контейнеры:
- Запуск только приложения:
  ```sh
  make up-app
  ```
- Запуск только базы данных:
  ```sh
  make up-db
  ```
- Запуск только Kafka брокера:
  ```sh
  make up-broker
  ```
- Запуск контейнеров для тестов:
  ```sh
  make up-db-test
  make up-broker-test
  ```

#### Остановка контейнеров

Для остановки всех контейнеров выполните команду:
```sh
make down
```

Если вам нужно остановить только определенные контейнеры:
- Остановка только приложения:
  ```sh
  make down-app
  ```
- Остановка только базы данных:
  ```sh
  make down-db
  ```
- Остановка только Kafka брокера:
  ```sh
  make down-broker
  ```
- Остановка контейнеров для тестов:
  ```sh
  make down-db-test
  make down-broker-test
  ```

#### Миграция базы данных

Для применения миграций базы данных выполните команду:
```sh
make migrate
```

Для выполнения миграций в тестовой базе данных:
```sh
make migrate-test
```

Для отката миграций базы данных:
```sh
make demigrate
```

Для отката миграций в тестовой базе данных:
```sh
make demigrate-test
```

#### Основные процессы

- Запуск сервера:
  ```sh
  make server
  ```
- Запуск SQL-клиента:
  ```sh
  make sql
  ```
- Запуск SQL-клиента для тестов:
  ```sh
  make sql-test
  ```

#### Открытие shell внутри контейнеров

- Открытие shell внутри контейнера приложения:
  ```sh
  make shell-app
  ```
- Открытие shell внутри контейнера базы данных:
  ```sh
  make shell-db
  ```
- Открытие shell внутри контейнера тестовой базы данных:
  ```sh
  make shell-db-test
  ```
- Открытие shell внутри контейнера Kafka брокера:
  ```sh
  make shell-broker
  ```
- Открытие shell внутри контейнера тестового Kafka брокера:
  ```sh
  make shell-broker-test
  ```

#### Работа с моками

Для создания моков выполните команду:
```sh
make mocks
```

#### Тестирование

Перед запуском тестов, не забудьте сгенирировать моки через `make mocks`, если вы ещё их не сгенирировали.

Для запуска всех тестов выполните команду:
```sh
make tests
```

Для запуска отдельных тестов:
- Юнит-тесты:
  ```sh
  make tests-unit
  ```
- Интеграционные тесты:
  ```sh
  make tests-int
  ```

Генерация необходимых для работы с gRPC go-файлов:
```sh
  make generate
```

`make generate` также отвечает за генерацию зависимостей. И чтобы заново не генерировать зависимости можно вызвать:
```sh
  make generate-no-deps
```